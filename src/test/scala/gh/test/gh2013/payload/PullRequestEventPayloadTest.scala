package gh.test.gh2013.payload

import gh2013.payloads.{PullRequestEventPayload}
import net.liftweb.json._
import org.scalatest.{Matchers, FlatSpec}

class PullRequestEventPayloadTest extends FlatSpec with Matchers
{
   "A valid PullRequestEvent payload" must "be correctly parsed" in {
      val json = parse(
         """
           | {
           |
           |    "number":152,
           |    "action":"closed",
           |    "pull_request":{
           |        "milestone":null,
           |        "comments":0,
           |        "comments_url":"https://api.github.com/repos/libgit2/rugged/issues/152/comments",
           |        "review_comments":0,
           |        "review_comments_url":"https://github.com/libgit2/rugged/pull/152/comments",
           |        "deletions":17,
           |        "number":152,
           |        "created_at":"2012-12-31T23:21:30Z",
           |        "merge_commit_sha":"0c5d05cd6ff6fa57585f4d09c2997393f926fc35",
           |        "closed_at":"2013-01-01T08:05:25Z",
           |        "url":"https://api.github.com/repos/libgit2/rugged/pulls/152",
           |        "merged_at":"2013-01-01T08:05:25Z",
           |        "_links":{
           |            "comments":{
           |                "href":"https://api.github.com/repos/libgit2/rugged/issues/152/comments"
           |            },
           |            "review_comments":{
           |                "href":"https://api.github.com/repos/libgit2/rugged/pulls/152/comments"
           |            },
           |            "self":{
           |                "href":"https://api.github.com/repos/libgit2/rugged/pulls/152"
           |            },
           |            "issue":{
           |                "href":"https://api.github.com/repos/libgit2/rugged/issues/152"
           |            },
           |            "html":{
           |                "href":"https://github.com/libgit2/rugged/pull/152"
           |            }
           |        },
           |        "additions":17,
           |        "id":3515028,
           |        "mergeable":null,
           |        "state":"closed",
           |        "mergeable_state":"unknown",
           |        "body":"**Bonne Ann√©e, Bon Any Nou, Buon Anno**",
           |        "changed_files":17,
           |        "patch_url":"https://github.com/libgit2/rugged/pull/152.patch",
           |        "merged":true,
           |        "commits_url":"https://github.com/libgit2/rugged/pull/152/commits",
           |        "html_url":"https://github.com/libgit2/rugged/pull/152",
           |        "user":{
           |            "events_url":"https://api.github.com/users/tnm/events{/privacy}",
           |            "repos_url":"https://api.github.com/users/tnm/repos",
           |            "url":"https://api.github.com/users/tnm",
           |            "organizations_url":"https://api.github.com/users/tnm/orgs",
           |            "id":126905,
           |            "avatar_url":"https://secure.gravatar.com/avatar/803993dc11765d89aee137f29aa05d3a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
           |            "gravatar_id":"803993dc11765d89aee137f29aa05d3a",
           |            "type":"User",
           |            "received_events_url":"https://api.github.com/users/tnm/received_events",
           |            "subscriptions_url":"https://api.github.com/users/tnm/subscriptions",
           |            "starred_url":"https://api.github.com/users/tnm/starred{/owner}{/repo}",
           |            "login":"tnm",
           |            "followers_url":"https://api.github.com/users/tnm/followers",
           |            "following_url":"https://api.github.com/users/tnm/following",
           |            "gists_url":"https://api.github.com/users/tnm/gists{/gist_id}"
           |        },
           |        "diff_url":"https://github.com/libgit2/rugged/pull/152.diff",
           |        "review_comment_url":"/repos/libgit2/rugged/pulls/comments/{number}",
           |        "updated_at":"2013-01-01T08:05:25Z",
           |        "head":{
           |            "repo":{
           |                "events_url":"https://api.github.com/repos/tnm/rugged/events",
           |                "comments_url":"https://api.github.com/repos/tnm/rugged/comments{/number}",
           |                "full_name":"tnm/rugged",
           |                "open_issues_count":0,
           |                "hooks_url":"https://api.github.com/repos/tnm/rugged/hooks",
           |                "git_commits_url":"https://api.github.com/repos/tnm/rugged/git/commits{/sha}",
           |                "created_at":"2012-12-17T22:00:58Z",
           |                "git_refs_url":"https://api.github.com/repos/tnm/rugged/git/refs{/sha}",
           |                "git_url":"git://github.com/tnm/rugged.git",
           |                "size":248,
           |                "pushed_at":"2012-12-31T23:19:30Z",
           |                "url":"https://api.github.com/repos/tnm/rugged",
           |                "open_issues":0,
           |                "merges_url":"https://api.github.com/repos/tnm/rugged/merges",
           |                "statuses_url":"https://api.github.com/repos/tnm/rugged/statuses/{sha}",
           |                "id":7213068,
           |                "git_tags_url":"https://api.github.com/repos/tnm/rugged/git/tags{/sha}",
           |                "contributors_url":"https://api.github.com/repos/tnm/rugged/contributors",
           |                "has_downloads":true,
           |                "stargazers_url":"https://api.github.com/repos/tnm/rugged/stargazers",
           |                "subscription_url":"https://api.github.com/repos/tnm/rugged/subscription",
           |                "has_issues":false,
           |                "compare_url":"https://api.github.com/repos/tnm/rugged/compare/{base}...{head}",
           |                "forks_count":0,
           |                "clone_url":"https://github.com/tnm/rugged.git",
           |                "contents_url":"https://api.github.com/repos/tnm/rugged/contents/{+path}",
           |                "master_branch":"development",
           |                "mirror_url":null,
           |                "fork":true,
           |                "blobs_url":"https://api.github.com/repos/tnm/rugged/git/blobs{/sha}",
           |                "branches_url":"https://api.github.com/repos/tnm/rugged/branches{/branch}",
           |                "trees_url":"https://api.github.com/repos/tnm/rugged/git/trees{/sha}",
           |                "private":false,
           |                "watchers":1,
           |                "teams_url":"https://api.github.com/repos/tnm/rugged/teams",
           |                "downloads_url":"https://api.github.com/repos/tnm/rugged/downloads",
           |                "default_branch":"development",
           |                "forks_url":"https://api.github.com/repos/tnm/rugged/forks",
           |                "assignees_url":"https://api.github.com/repos/tnm/rugged/assignees{/user}",
           |                "svn_url":"https://github.com/tnm/rugged",
           |                "archive_url":"https://api.github.com/repos/tnm/rugged/{archive_format}{/ref}",
           |                "subscribers_url":"https://api.github.com/repos/tnm/rugged/subscribers",
           |                "commits_url":"https://api.github.com/repos/tnm/rugged/commits{/sha}",
           |                "issues_url":"https://api.github.com/repos/tnm/rugged/issues{/number}",
           |                "html_url":"https://github.com/tnm/rugged",
           |                "tags_url":"https://api.github.com/repos/tnm/rugged/tags{/tag}",
           |                "updated_at":"2012-12-31T23:19:33Z",
           |                "milestones_url":"https://api.github.com/repos/tnm/rugged/milestones{/number}",
           |                "watchers_count":1,
           |                "languages_url":"https://api.github.com/repos/tnm/rugged/languages",
           |                "notifications_url":"https://api.github.com/repos/tnm/rugged/notifications{?since,all,participating}",
           |                "ssh_url":"git@github.com:tnm/rugged.git",
           |                "name":"rugged",
           |                "description":"ruby bindings to libgit2",
           |                "labels_url":"https://api.github.com/repos/tnm/rugged/labels{/name}",
           |                "language":"C",
           |                "collaborators_url":"https://api.github.com/repos/tnm/rugged/collaborators{/collaborator}",
           |                "homepage":"",
           |                "keys_url":"https://api.github.com/repos/tnm/rugged/keys{/key_id}",
           |                "issue_events_url":"https://api.github.com/repos/tnm/rugged/issues/events{/number}",
           |                "forks":0,
           |                "pulls_url":"https://api.github.com/repos/tnm/rugged/pulls{/number}",
           |                "issue_comment_url":"https://api.github.com/repos/tnm/rugged/issues/comments/{number}",
           |                "owner":{
           |                    "events_url":"https://api.github.com/users/tnm/events{/privacy}",
           |                    "repos_url":"https://api.github.com/users/tnm/repos",
           |                    "url":"https://api.github.com/users/tnm",
           |                    "organizations_url":"https://api.github.com/users/tnm/orgs",
           |                    "id":126905,
           |                    "avatar_url":"https://secure.gravatar.com/avatar/803993dc11765d89aee137f29aa05d3a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
           |                    "gravatar_id":"803993dc11765d89aee137f29aa05d3a",
           |                    "type":"User",
           |                    "received_events_url":"https://api.github.com/users/tnm/received_events",
           |                    "subscriptions_url":"https://api.github.com/users/tnm/subscriptions",
           |                    "starred_url":"https://api.github.com/users/tnm/starred{/owner}{/repo}",
           |                    "login":"tnm",
           |                    "followers_url":"https://api.github.com/users/tnm/followers",
           |                    "following_url":"https://api.github.com/users/tnm/following",
           |                    "gists_url":"https://api.github.com/users/tnm/gists{/gist_id}"
           |                },
           |                "has_wiki":false
           |            },
           |            "label":"tnm:update-date",
           |            "sha":"07a901581e43231a205aa868e4c7aea22161e99b",
           |            "user":{
           |                "events_url":"https://api.github.com/users/tnm/events{/privacy}",
           |                "repos_url":"https://api.github.com/users/tnm/repos",
           |                "url":"https://api.github.com/users/tnm",
           |                "organizations_url":"https://api.github.com/users/tnm/orgs",
           |                "id":126905,
           |                "avatar_url":"https://secure.gravatar.com/avatar/803993dc11765d89aee137f29aa05d3a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
           |                "gravatar_id":"803993dc11765d89aee137f29aa05d3a",
           |                "type":"User",
           |                "received_events_url":"https://api.github.com/users/tnm/received_events",
           |                "subscriptions_url":"https://api.github.com/users/tnm/subscriptions",
           |                "starred_url":"https://api.github.com/users/tnm/starred{/owner}{/repo}",
           |                "login":"tnm",
           |                "followers_url":"https://api.github.com/users/tnm/followers",
           |                "following_url":"https://api.github.com/users/tnm/following",
           |                "gists_url":"https://api.github.com/users/tnm/gists{/gist_id}"
           |            },
           |            "ref":"update-date"
           |        },
           |        "merged_by":{
           |            "events_url":"https://api.github.com/users/tnm/events{/privacy}",
           |            "repos_url":"https://api.github.com/users/tnm/repos",
           |            "url":"https://api.github.com/users/tnm",
           |            "organizations_url":"https://api.github.com/users/tnm/orgs",
           |            "id":126905,
           |            "avatar_url":"https://secure.gravatar.com/avatar/803993dc11765d89aee137f29aa05d3a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
           |            "gravatar_id":"803993dc11765d89aee137f29aa05d3a",
           |            "type":"User",
           |            "received_events_url":"https://api.github.com/users/tnm/received_events",
           |            "subscriptions_url":"https://api.github.com/users/tnm/subscriptions",
           |            "starred_url":"https://api.github.com/users/tnm/starred{/owner}{/repo}",
           |            "login":"tnm",
           |            "followers_url":"https://api.github.com/users/tnm/followers",
           |            "following_url":"https://api.github.com/users/tnm/following",
           |            "gists_url":"https://api.github.com/users/tnm/gists{/gist_id}"
           |        },
           |        "issue_url":"https://github.com/libgit2/rugged/issues/152",
           |        "base":{
           |            "repo":{
           |                "events_url":"https://api.github.com/repos/libgit2/rugged/events",
           |                "comments_url":"https://api.github.com/repos/libgit2/rugged/comments{/number}",
           |                "full_name":"libgit2/rugged",
           |                "open_issues_count":18,
           |                "hooks_url":"https://api.github.com/repos/libgit2/rugged/hooks",
           |                "git_commits_url":"https://api.github.com/repos/libgit2/rugged/git/commits{/sha}",
           |                "created_at":"2010-09-10T16:18:17Z",
           |                "git_refs_url":"https://api.github.com/repos/libgit2/rugged/git/refs{/sha}",
           |                "git_url":"git://github.com/libgit2/rugged.git",
           |                "size":356,
           |                "pushed_at":"2013-01-01T08:05:24Z",
           |                "url":"https://api.github.com/repos/libgit2/rugged",
           |                "open_issues":18,
           |                "merges_url":"https://api.github.com/repos/libgit2/rugged/merges",
           |                "statuses_url":"https://api.github.com/repos/libgit2/rugged/statuses/{sha}",
           |                "id":901663,
           |                "git_tags_url":"https://api.github.com/repos/libgit2/rugged/git/tags{/sha}",
           |                "contributors_url":"https://api.github.com/repos/libgit2/rugged/contributors",
           |                "has_downloads":true,
           |                "stargazers_url":"https://api.github.com/repos/libgit2/rugged/stargazers",
           |                "subscription_url":"https://api.github.com/repos/libgit2/rugged/subscription",
           |                "has_issues":true,
           |                "compare_url":"https://api.github.com/repos/libgit2/rugged/compare/{base}...{head}",
           |                "forks_count":59,
           |                "clone_url":"https://github.com/libgit2/rugged.git",
           |                "contents_url":"https://api.github.com/repos/libgit2/rugged/contents/{+path}",
           |                "master_branch":"development",
           |                "mirror_url":null,
           |                "fork":false,
           |                "blobs_url":"https://api.github.com/repos/libgit2/rugged/git/blobs{/sha}",
           |                "branches_url":"https://api.github.com/repos/libgit2/rugged/branches{/branch}",
           |                "trees_url":"https://api.github.com/repos/libgit2/rugged/git/trees{/sha}",
           |                "private":false,
           |                "watchers":488,
           |                "teams_url":"https://api.github.com/repos/libgit2/rugged/teams",
           |                "downloads_url":"https://api.github.com/repos/libgit2/rugged/downloads",
           |                "default_branch":"development",
           |                "forks_url":"https://api.github.com/repos/libgit2/rugged/forks",
           |                "assignees_url":"https://api.github.com/repos/libgit2/rugged/assignees{/user}",
           |                "svn_url":"https://github.com/libgit2/rugged",
           |                "archive_url":"https://api.github.com/repos/libgit2/rugged/{archive_format}{/ref}",
           |                "subscribers_url":"https://api.github.com/repos/libgit2/rugged/subscribers",
           |                "commits_url":"https://api.github.com/repos/libgit2/rugged/commits{/sha}",
           |                "issues_url":"https://api.github.com/repos/libgit2/rugged/issues{/number}",
           |                "html_url":"https://github.com/libgit2/rugged",
           |                "tags_url":"https://api.github.com/repos/libgit2/rugged/tags{/tag}",
           |                "updated_at":"2013-01-01T08:05:24Z",
           |                "milestones_url":"https://api.github.com/repos/libgit2/rugged/milestones{/number}",
           |                "watchers_count":488,
           |                "languages_url":"https://api.github.com/repos/libgit2/rugged/languages",
           |                "notifications_url":"https://api.github.com/repos/libgit2/rugged/notifications{?since,all,participating}",
           |                "ssh_url":"git@github.com:libgit2/rugged.git",
           |                "name":"rugged",
           |                "description":"ruby bindings to libgit2",
           |                "labels_url":"https://api.github.com/repos/libgit2/rugged/labels{/name}",
           |                "language":"C",
           |                "collaborators_url":"https://api.github.com/repos/libgit2/rugged/collaborators{/collaborator}",
           |                "homepage":"",
           |                "keys_url":"https://api.github.com/repos/libgit2/rugged/keys{/key_id}",
           |                "issue_events_url":"https://api.github.com/repos/libgit2/rugged/issues/events{/number}",
           |                "forks":59,
           |                "pulls_url":"https://api.github.com/repos/libgit2/rugged/pulls{/number}",
           |                "issue_comment_url":"https://api.github.com/repos/libgit2/rugged/issues/comments/{number}",
           |                "owner":{
           |                    "events_url":"https://api.github.com/users/libgit2/events{/privacy}",
           |                    "repos_url":"https://api.github.com/users/libgit2/repos",
           |                    "url":"https://api.github.com/users/libgit2",
           |                    "organizations_url":"https://api.github.com/users/libgit2/orgs",
           |                    "id":394745,
           |                    "avatar_url":"https://secure.gravatar.com/avatar/1c56acccc41c591705dc92da5f6ab603?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png",
           |                    "gravatar_id":"1c56acccc41c591705dc92da5f6ab603",
           |                    "type":"Organization",
           |                    "received_events_url":"https://api.github.com/users/libgit2/received_events",
           |                    "subscriptions_url":"https://api.github.com/users/libgit2/subscriptions",
           |                    "starred_url":"https://api.github.com/users/libgit2/starred{/owner}{/repo}",
           |                    "login":"libgit2",
           |                    "followers_url":"https://api.github.com/users/libgit2/followers",
           |                    "following_url":"https://api.github.com/users/libgit2/following",
           |                    "gists_url":"https://api.github.com/users/libgit2/gists{/gist_id}"
           |                },
           |                "has_wiki":false
           |            },
           |            "label":"libgit2:development",
           |            "sha":"47678c7ebfa9c9098131bcd3efd91b293617eeab",
           |            "user":{
           |                "events_url":"https://api.github.com/users/libgit2/events{/privacy}",
           |                "repos_url":"https://api.github.com/users/libgit2/repos",
           |                "url":"https://api.github.com/users/libgit2",
           |                "organizations_url":"https://api.github.com/users/libgit2/orgs",
           |                "id":394745,
           |                "avatar_url":"https://secure.gravatar.com/avatar/1c56acccc41c591705dc92da5f6ab603?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png",
           |                "gravatar_id":"1c56acccc41c591705dc92da5f6ab603",
           |                "type":"Organization",
           |                "received_events_url":"https://api.github.com/users/libgit2/received_events",
           |                "subscriptions_url":"https://api.github.com/users/libgit2/subscriptions",
           |                "starred_url":"https://api.github.com/users/libgit2/starred{/owner}{/repo}",
           |                "login":"libgit2",
           |                "followers_url":"https://api.github.com/users/libgit2/followers",
           |                "following_url":"https://api.github.com/users/libgit2/following",
           |                "gists_url":"https://api.github.com/users/libgit2/gists{/gist_id}"
           |            },
           |            "ref":"development"
           |        },
           |        "title":"Bring us into 2013",
           |        "commits":1,
           |        "assignee":null
           |    }
           |
           |}
         """.stripMargin)

      PullRequestEventPayload(json) shouldBe 'defined
   }
}
